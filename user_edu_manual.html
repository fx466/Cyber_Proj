<!DOCTYPE html>
<html lang="en">
<head>
<title>User Education Manual</title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
<link rel="stylesheet" href="https://www.w3schools.com/lib/w3-theme-black.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>
html,body,h1,h2,h3,h4,h5,h6 {font-family: "Roboto", sans-serif;}
.w3-sidebar {
  z-index: 3;
  width: 250px;
  top: 43px;
  bottom: 0;
  height: inherit;
}
/* 添加内容区域的显示/隐藏样式 */
.content-section {
  display: none;
}
.content-section.active {
  display: block;
}
</style>
</head>
<body>

<!-- Navbar -->
<div class="w3-top">
  <div class="w3-bar w3-theme w3-top w3-left-align w3-large">
    <a class="w3-bar-item w3-button w3-right w3-hide-large w3-hover-white w3-large w3-theme-l1" href="javascript:void(0)" onclick="w3_open()"><i class="fa fa-bars"></i></a>
    <a href="#" class="w3-bar-item w3-button w3-theme-l1">Homepage</a>
    <!-- <a href="#" class="w3-bar-item w3-button w3-hide-small w3-hover-white">About</a> -->

  </div>
</div>

<!-- Sidebar -->
<nav class="w3-sidebar w3-bar-block w3-collapse w3-large w3-theme-l5 w3-animate-left" id="mySidebar">
  <a href="javascript:void(0)" onclick="w3_close()" class="w3-right w3-xlarge w3-padding-large w3-hover-black w3-hide-large" title="Close Menu">
    <i class="fa fa-remove"></i>
  </a>
  <h4 class="w3-bar-item" onclick="showContent('content0')"><b>Dashboard</b></h4>
  <a class="w3-bar-item w3-button w3-hover-black" href="#" onclick="showContent('content1')">Authentication Security</a>
  <a class="w3-bar-item w3-button w3-hover-black" href="#" onclick="showContent('content2')">File Upload Security</a>
  <a class="w3-bar-item w3-button w3-hover-black" href="#" onclick="showContent('content3')">Database Security</a>
  <a class="w3-bar-item w3-button w3-hover-black" href="#" onclick="showContent('content4')">CSRF Security</a>
</nav>

<!-- Overlay effect when opening sidebar on small screens -->
<div class="w3-overlay w3-hide-large" onclick="w3_close()" style="cursor:pointer" title="close side menu" id="myOverlay"></div>

<!-- Main content: shift it to the right by 250 pixels when the sidebar is visible -->
<div class="w3-main" style="margin-left:250px">

    <!-- Dashboard Section -->
    <div id="content0" class="content-section active">
      <div class="w3-row w3-padding-64">
        <div class="w3-twothird w3-container">
          <h1 class="w3-text-teal">Project Background</h1>
          <p>Content for Dashboard...</p>
          <h1 class="w3-text-teal">Security Evaluation</h1>
          <p>Content for Dashboard...</p>
          <h1 class="w3-text-teal">Security Implementation's Necessity</h1>
          <p>Content for Dashboard...</p>
          <h1 class="w3-text-teal">Common Security Implementation and Their Effects</h1>
          <p>Content for Dashboard...</p>
          <h1 class="w3-text-teal">Implementation Steps</h1>
          <p>Content for Dashboard...</p>

        </div>
        <div class="w3-third w3-container">
          <p class="w3-border w3-padding-large w3-padding-32 w3-center">AD</p>
          <p class="w3-border w3-padding-large w3-padding-64 w3-center">AD</p>
        </div>
      </div>
      
  
    </div>
  



  <!-- Content Section 1 -->
  <div id="content1" class="content-section">
    <div class="w3-row w3-padding-64">
      <div class="w3-twothird w3-container">
        <h1 class="w3-text-teal">Vulnerability Introduction</h1>
        <p>Content for section 1...</p>
        <h1 class="w3-text-teal">Locating Vulnerability</h1>
        <p>Content for section 1...</p>
        <h1 class="w3-text-teal">Fixing Vulnerability</h1>
        <p>Content for section 1...</p>
        <h1 class="w3-text-teal">Testing</h1>
        <p>Content for section 1...</p>
      </div>
      <div class="w3-third w3-container">
        <p class="w3-border w3-padding-large w3-padding-32 w3-center">AD</p>
        <p class="w3-border w3-padding-large w3-padding-64 w3-center">AD</p>
      </div>
    </div>
    

  </div>

  <!-- Content Section 2 -->
  <div id="content2" class="content-section">
    <div class="w3-row w3-padding-64">
      <div class="w3-twothird w3-container">
        <h1 class="w3-text-teal">Vulnerability Introduction</h1>
        <p>Content for section 2...</p>
        <h1 class="w3-text-teal">Locating Vulnerability</h1>
        <p>Content for section 2...</p>
        <h1 class="w3-text-teal">Fixing Vulnerability</h1>
        <p>Content for section 2...</p>
        <h1 class="w3-text-teal">Testing</h1>
        <p>Content for section 2...</p>
      </div>
      <div class="w3-third w3-container">
        <p class="w3-border w3-padding-large w3-padding-32 w3-center">AD</p>
        <p class="w3-border w3-padding-large w3-padding-64 w3-center">AD</p>
      </div>
    </div>
    

  </div>

  <!-- Content Section 3 -->
  <div id="content3" class="content-section">
    <div class="w3-row w3-padding-64">
      <div class="w3-twothird w3-container">
        <h1 class="w3-text-teal">Vulnerability Introduction</h1>
        <p>Content for section 3...</p>
        <h1 class="w3-text-teal">Locating Vulnerability</h1>
        <p>Content for section 3...</p>
        <h1 class="w3-text-teal">Fixing Vulnerability</h1>
        <p>Content for section 3...</p>
        <h1 class="w3-text-teal">Testing</h1>
        <p>Content for section 3...</p>
      </div>
      <div class="w3-third w3-container">
        <p class="w3-border w3-padding-large w3-padding-32 w3-center">AD</p>
        <p class="w3-border w3-padding-large w3-padding-64 w3-center">AD</p>
      </div>
    </div>
    
    <!-- Pagination -->

  </div>

    <!-- Content Section 3 -->
    <div id="content4" class="content-section">
      <div class="w3-row w3-padding-64">
        <div class="w3-twothird w3-container">
          <!-- Vulnerability Introduction -->
          <h1 class="w3-text-teal">Vulnerability Introduction</h1>
          <p>Cross-Site Request Forgery (CSRF) is a common Web security vulnerability that allows an attacker to send malicious requests as a user without authorization. This attack exploits the authentication information of the user in the login state to trick them into performing unintended actions. Attackers typically embed malicious requests into legitimate websites visited by users by spoofing links or forms, causing users to unknowingly perform sensitive actions such as modifying account information or submitting transaction requests.
          </p>

          <p>The impact of CSRF vulnerabilities can be severe, especially on platforms that involve sensitive data or transactions. Successful attacks may lead to user account tampering, fund transfer, leakage of private information, and even in the case of administrator account hijacking, the attacker may gain full control of the system. As a result, CSRF vulnerabilities not only pose a personal risk to users, but may also compromise the integrity and security of the entire system.
          </p>

          <!-- Locating Vulnerability -->
          <h1 class="w3-text-teal">Locating Vulnerability</h1>
          <p style="font-weight: bolder;">1. Indicates the security vulnerability of application session</p>
          <p>Application sessions are the basis for user authentication and authorization, and an attacker can exploit an existing session to initiate a malicious request. Unprotected sessions can cause serious security problems, especially session fixation, which allows an attacker to exploit a user's valid session. The risk of CSRF attacks can be mitigated by strengthening session security, in particular by generating a unique session ID and updating it regularly.
          </p>
          <p style="font-weight: bolder;">2. Security vulnerability of web cookie</p>
          <p>CSRF attacks rely on the fact that the user's Cookie is automatically sent in a request. Cookies usually contain sensitive information such as session ids, and if this information is leaked or maliciously exploited, attackers can impersonate users to initiate requests. Therefore, it is important to protect the security of cookies. By enabling attributes such as HttpOnly, Secure, and SameSite, you can restrict how cookies are accessed and transmitted, reducing the opportunity for attackers to exploit them. In unprotected scenarios, cookies are automatically included in user requests. It is by manipulating this feature that CSRF attacks enable malicious requests to succeed. Therefore, ensuring the security of cookies can significantly reduce the attack surface.
          </p>
          <p style="font-weight: bolder;">3. Security of form interaction
          </p>  
          <p>Forms are a major vehicle for CSRF attacks, as many malicious requests exploit a user's logged in status by forging form submissions. The core of a CSRF attack is to trick users into submitting malicious forms. If the form submission is not verified with the CSRF token, any external site can forge the request and operate with the user's identity. Ensuring that each form contains a unique CSRF token prevents malicious form submissions. CSRF token authentication is one of the most effective measures to defend against CSRF attacks.
          </p>

          <!-- Fixing Vulnerability -->
          <h1 class="w3-text-teal">Fixing Vulnerability</h1>
          <p style="font-weight: bolder;">1. CSRF related variable definition: Cyber_Proj/system/core/Security.php</p>
          <p>$_csrf_hash: This is the hash of the CSRF token to verify that the request is legitimate. This hash value is generated each time a request is submitted and is saved in the user's browser Cookie.
          </p>
          <p>$_csrf_expire: Defines the expiration time of the CSRF token. The default is 7200 seconds (2 hours). This time limit ensures that the token will not be valid for a long time, reducing the risk of being exploited.</p>  
          <p>$_csrf_token_name and $_csrf_cookie_name: Define the name of the CSRF token and the Cookie that holds it, respectively. These names are used to validate the request when the form is submitted.
          </p>

          <p style="font-weight: bolder;">2. Generates a CSRF hash: Cyber_Proj/system/core/Security.php</p>
          <p>The method is responsible for generating the CSRF token. It first checks if the token in the Cookie already exists, and if it does and is in the correct format (a 32-character hexadecimal string), the token is used directly. If it does not exist or is incorrect, a new random number is generated as a token, obtained using get_random_bytes() or generated using the md5 hash function.</p>
          <img src="user_edu_imgs/csrf_set_hash.png" alt="csrf_set_hash" style="width:528px;height:358px;">
          
          <p style="font-weight: bolder;">3. CSRF constructor: Cyber_Proj/system/core/Security.php</p>
          <p>The method checks whether CSRF is enabled at initialization and loads CSRF-related Settings from the configuration file, such as token expiration time, token name, Cookie name, and so on. If a Cookie prefix is set in the configuration, the prefix is also automatically added to the name of the CSRF Cookie. Finally, the _csrf_set_hash() method is called to generate the CSRF token.</p>
          <img src="user_edu_imgs/csrf_construct.png" alt="csrf_construct" style="width:528px;height:458px;">
          
          <p style="font-weight: bolder;">4. CSRF verification: Cyber_Proj/system/core/Security.php</p>
          <p>This function is used to verify the CSRF token. It first checks the request type, skipping validation for secure HTTP methods (GET, HEAD, OPTIONS, POST). For other request methods, it compares the CSRF token submitted by the form to the token stored in the Cookie. If the two do not match, a CSRF error is triggered. If automatic regeneration of CSRF tokens is enabled, old tokens are destroyed and new tokens are generated after each submission. Finally, the _csrf_set_hash() method is called to regenerate the token, ensuring that a separate token is used for each request.</p>
          <img src="user_edu_imgs/csrf_verify.png" alt="csrf_verify" style="width:528px;height:758px;">

          <p style="font-weight: bolder;">5. CSRF Cookie: Cyber_Proj/system/core/Security.php</p>
          <p>This function is responsible for storing the generated CSRF token in the user's browser Cookie. It sets the expiration time, Cookie path, domain name, secure transport (cookie_secure), and HttpOnly attribute (cookie_httponly) according to the configuration. If the current connection is not HTTPS and cookie_secure is TRUE, the Cookie is not set.</p>
          <img src="user_edu_imgs/csrf_set_cookie.png" alt="csrf_set_cookie" style="width:528px;height:458px;">

          <p style="font-weight: bolder;">6. CSRF error displayed: Cyber_Proj/system/core/Security.php</p>
          <p>When CSRF token validation fails, this function triggers an HTTP 403 error indicating that the request is denied. This is to prevent unauthorized request operations.</p>
          <img src="user_edu_imgs/csrf_show_error.png" alt="csrf_show_error" style="width:528px;height:158px;">
          
          <p style="font-weight: bolder;">8. Get the CSRF token and name: Cyber_Proj/system/core/Security.php</p>
          <p>get_csrf_hash() : Returns the currently generated CSRF token.</p>
          <p>get_csrf_token_name() : Returns the name of the CSRF token for use in the form.</p>
          
          <p style="font-weight: bolder;">9. CSRF Token in the form: Cyber_Proj/application/views/admin/pages</p>
          <p>An array $csrf containing token names and hash values is generated by calling the get_csrf_token_name and get_csrf_hash methods from CodeIgniter's security class. In addition, a hidden input form field is created in the form, where the name attribute is the name of the CSRF token and the value attribute is the hash value of the CSRF token. This way, when the form is submitted, the CSRF token is sent to the server as part of the form data. By adding a CSRF token to the form, it prevents attackers from forging user identities and sending malicious requests. An attacker cannot easily obtain a legitimate CSRF token and therefore cannot impersonate a user through a forged form to initiate an operation.</p>
          <img src="user_edu_imgs/csrf_form.png" alt="csrf_form" style="width:528px;height:158px;">

          <p style="font-weight: bolder;">10. Set the appropriate security configuration: Cyber_Proj/application/config/config.php</p>
          <p>Enabling CSRF protection throughout the application ensures that every form submission in the application automatically generates and validates a unique CSRF token, which is verified on the server side to ensure that the request is from a legitimate source. This is a fundamental defense against CSRF attacks and prevents maliciously crafted forms from being executed.</p>
          <img src="user_edu_imgs/csrf_protection_enable.png" alt="csrf_protection_enable" style="width:528px;height:25px;">
          
          <p>In our implementation, we define the name of the CSRF token and the name of the corresponding CSRF cookie. In addition, we set the expiration time of the CSRF token to 2 hours. This ensures the user experience and prevents long-lived tokens from being utilized by attackers. At the same time, the automatic regeneration of CSRF tokens is enabled to ensure that the token is updated every time the form is submitted, which further improves security and avoids duplicate token usage. In order to improve application compatibility and flexibility, we have kept the option to exclude CSRF checks in certain scenarios. For example, for some external callbacks or interfaces that do not require CSRF protection, you can configure the configuration to exclude the relevant URIs to ensure that the application will not be blocked from normal business processes due to security checks.</p>
          <img src="user_edu_imgs/csrf_token_config.png" alt="csrf_token_config" style="width:528px;height:128px;">
          
          <p>In terms of enhancing cookie security, our current configuration allows cookies to be accessed via JavaScript and allows cookies to be transmitted over HTTP connections. In a production environment, we recommend enabling these two options, setting the HttpOnly and Secure properties to prevent CSRF token theft through XSS attacks, and ensuring that cookies are only transferred over HTTPS-encrypted connections to further enhance overall security.</p>
          <img src="user_edu_imgs/csrf_cookie_config.png" alt="csrf_cookie_config" style="width:528px;height:118px;">

          
          

          <!-- Testing -->
          <h1 class="w3-text-teal">Testing</h1>
          <p style="font-weight: bolder;">1. Download the Postman test tool: https://www.postman.com/</p>
          <p>When using Postman to test CSRF tokens, the main purpose is to simulate browser behavior by submitting a request containing the CSRF token through a form, ensuring that the server can verify the correctness of the CSRF token.</p>

          <p style="font-weight: bolder;">2. Test a legitimate request</p>
          <p>Select specific request types which are included in the whiltelist such as GET and POST, then enter the destination URL and click send. If the server returns 200, it is successful; otherwise, 403 is denied.</p>
          <img src="user_edu_imgs/csrf_request_testing.png" alt="csrf_request_testing" style="width:528px;height:248px;">

          <p style="font-weight: bolder;">3. Test CSRF Token value</p>
          <p>Click Haders to view the cookie parameter. If there is a value and the secure state is ture, it indicates that the security protection of the csrf token is working</p>
          <img src="user_edu_imgs/csrf_token_testing.png" alt="csrf_token_testing" style="width:528px;height:248px;">
        </div>
        <div class="w3-third w3-container">
          <p class="w3-border w3-padding-large w3-padding-32 w3-center">AD</p>
          <p class="w3-border w3-padding-large w3-padding-64 w3-center">AD</p>
        </div>
      </div>
      

    </div>




</div>

<script>
// Get the Sidebar
var mySidebar = document.getElementById("mySidebar");

// Get the DIV with overlay effect
var overlayBg = document.getElementById("myOverlay");

// Toggle between showing and hiding the sidebar, and add overlay effect
function w3_open() {
  if (mySidebar.style.display === 'block') {
    mySidebar.style.display = 'none';
    overlayBg.style.display = "none";
  } else {
    mySidebar.style.display = 'block';
    overlayBg.style.display = "block";
  }
}

// Close the sidebar with the close button
function w3_close() {
  mySidebar.style.display = "none";
  overlayBg.style.display = "none";
}

// 添加内容切换功能
function showContent(contentId) {
  // 隐藏所有内容区域
  var contents = document.getElementsByClassName('content-section');
  for (var i = 0; i < contents.length; i++) {
    contents[i].classList.remove('active');
  }
  
  // 显示选中的内容区域
  document.getElementById(contentId).classList.add('active');
}
</script>

</body>
</html>